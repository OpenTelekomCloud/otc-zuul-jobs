---
- job:
    name: refstack-client-run
    parent: refstack-client-run-base
    vars:
      refstack_environment: "production_eu-de"
    secrets:
      - secret: refstack_credentials
        name: refstack_credentials
        pass-to-parent: true
      - alerta_data
      - secret: refstack_database
        name: refstack_database
        pass-to-parent: true

- job:
    name: refstack-client-run-preprod
    parent: refstack-client-run-base
    vars:
      refstack_environment: "preprod"
      tempest_count_users: 8
      tempest_image_ref: 3fab204d-2371-477e-9149-4a6146c3a771
      tempest_image_ref_alt: e49199fd-9934-40b3-986b-dc06023a5f5c
    secrets:
      - secret: refstack_credentials_preprod
        name: refstack_credentials
        pass-to-parent: true
      - alerta_data
      - secret: refstack_database
        name: refstack_database
        pass-to-parent: true

- job:
    name: otc-zuul-jobs-linters
    parent: tox
    description: |
      This job runs against base-jobs, project-config, otc-zuul-jobs
      and zuul-jobs so we can properly lint our ansible playbooks / roles.
    required-projects:
      - opentelekomcloud-infra/base-jobs
      - opentelekomcloud-infra/otc-zuul-jobs
      - opentelekomcloud-infra/zuul-project-config
      - opentelekomcloud-infra/system-config
      - zuul/zuul-jobs
    nodeset: fedora-pod
    vars:
      tox_envlist: linters
      tox_environment:
        ANSIBLE_ROLES_PATH: ~/src/github.com/opentelekomcloud-infra/base-jobs/roles:~/src/opendev.org/zuul/zuul-jobs/roles:~/src/github.comg/opentelekomcloud-infra/otc-zuul-jobs/roles:~/src/github.com/opentelekomcloud-infra/project-config/roles:~/src/github.com/opentelekomcloud-infra/system-config/roles

- job:
    name: otc-promote-docs-base
    description: |
      Publish a previously built branch-tip documentation tarball.
      Use this in the promote pipeline to publish a branch tip tarball
      built in the gate pipeline.
      This is an abstract job intended to be inherited from in an
      Eco tenant and an appropriate secret added.
      #      .. zuul:jobvar:: afs
      #         :type: dict
      #         This is expected to be a Zuul Secret with these keys:
      #        .. zuul:jobvar:: keytab
      #           The AFS keytab for the service principal.
      #        .. zuul:jobvar:: service_name
      #           The name of the service princpal.
      #        .. zuul:jobvar:: docs_master_path
      #           The full docs publication path to use if the job is run on
      #           the master branch.
      #        .. zuul:jobvar:: docs_branch_path
      #           The full docs publication path to use if the job is run on
      #           any other branch.
      #        .. zuul:jobvar:: docs_tag_path
      #           The full docs publication path to use if the job is run on
      #           a tag.
      #        .. zuul:jobvar:: docs_redirect_path
      #           If this variable is present, a .htaccess redirect will be
      #           created at this path when the job is run on the master
      #           branch.  For example, it can be used to redirect "project/"
      #           to "project/latest".
      #        .. zuul:jobvar:: docs_redirect_content
      #           The contents of the .htaccess file in docs_redirect_path.
      .. zuul:jobvar:: download_artifact_job
         The name of the job which built the docs artifact which this
         job should download and promote.
       .. zuul:jobvar:: write_root_marker
          If this is set to false, then the root marker file is not
          written.

          Warning: setting this parameter incorrectly can result in loss of published data.
    abstract: True
    run: playbooks/docs/promote.yaml
    vars:
      write_root_marker: true
    nodeset:
      nodes: []

